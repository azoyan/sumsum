<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, maximum-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="mobile-web-app-capable" content="yes">
  <meta name="theme-color" content="#0f172a">
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icons/icon.svg" type="image/svg+xml">
  <link rel="apple-touch-icon" href="icons/icon.svg">
  <title>SumSum — Математическая головоломка</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="stylesheet" href="css/animations.css">
  <link rel="stylesheet" href="css/responsive.css">
</head>
<body>
  <!-- Экран меню -->
  <div id="menu-screen" class="screen active">
    <div class="menu-container">
      <h1 class="game-title">Sum<span class="accent">Sum</span></h1>
      <p class="game-subtitle">Математическая головоломка</p>
      <div class="menu-buttons">
        <button id="btn-play" class="btn btn-primary">Играть</button>
        <button id="btn-how-to-play" class="btn btn-secondary">Как играть</button>
        <button id="btn-settings" class="btn btn-secondary">Настройки</button>
      </div>
      <div class="menu-stats">
        <div class="stat-item">
          <span class="stat-label">Рекорд</span>
          <span id="menu-high-score" class="stat-value">0</span>
        </div>
        <div class="stat-item">
          <span class="stat-label">Игры</span>
          <span id="menu-total-games" class="stat-value">0</span>
        </div>
      </div>
    </div>
  </div>

  <!-- Экран обучения -->
  <div id="tutorial-screen" class="screen">
    <div class="tutorial-container">
      <h2>Как играть</h2>
      <div class="tutorial-steps">
        <div class="tutorial-step">
          <div class="tutorial-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" focusable="false">
              <path d="M11 12a1 1 0 1 0 2 0a1 1 0 1 0 -2 0" />
              <path d="M12 7a5 5 0 1 0 5 5" />
              <path d="M13 3.055a9 9 0 1 0 7.941 7.945" />
              <path d="M15 6v3h3l3 -3h-3v-3l-3 3" />
              <path d="M15 9l-3 3" />
            </svg>
          </div>
          <p>Цель — собрать <strong>целевую сумму</strong>, показанную вверху экрана</p>
        </div>
        <div class="tutorial-step">
          <div class="tutorial-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" focusable="false">
              <path d="M8 13v-8.5a1.5 1.5 0 0 1 3 0v7.5" />
              <path d="M11 11.5v-2a1.5 1.5 0 0 1 3 0v2.5" />
              <path d="M14 10.5a1.5 1.5 0 0 1 3 0v1.5" />
              <path d="M17 11.5a1.5 1.5 0 0 1 3 0v4.5a6 6 0 0 1 -6 6h-2h.208a6 6 0 0 1 -5.012 -2.7l-.196 -.3c-.312 -.479 -1.407 -2.388 -3.286 -5.728a1.5 1.5 0 0 1 .536 -2.022a1.867 1.867 0 0 1 2.28 .28l1.47 1.47" />
              <path d="M5 3l-1 -1" />
              <path d="M4 7h-1" />
              <path d="M14 3l1 -1" />
              <path d="M15 6h1" />
            </svg>
          </div>
          <p>Нажимайте на <strong>кубики с числами</strong>, чтобы выбрать их</p>
        </div>
        <div class="tutorial-step">
          <div class="tutorial-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" focusable="false">
              <path d="M16 18a2 2 0 0 1 2 2a2 2 0 0 1 2 -2a2 2 0 0 1 -2 -2a2 2 0 0 1 -2 2" />
              <path d="M16 6a2 2 0 0 1 2 2a2 2 0 0 1 2 -2a2 2 0 0 1 -2 -2a2 2 0 0 1 -2 2" />
              <path d="M9 18a6 6 0 0 1 6 -6a6 6 0 0 1 -6 -6a6 6 0 0 1 -6 6a6 6 0 0 1 6 6" />
            </svg>
          </div>
          <p>Когда сумма выбранных кубиков совпадёт с целью — они <strong>исчезнут</strong></p>
        </div>
        <div class="tutorial-step">
          <div class="tutorial-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" focusable="false">
              <path d="M12 9v4" />
              <path d="M10.363 3.591l-8.106 13.534a1.914 1.914 0 0 0 1.636 2.871h16.214a1.914 1.914 0 0 0 1.636 -2.87l-8.106 -13.536a1.914 1.914 0 0 0 -3.274 0" />
              <path d="M12 16h.01" />
            </svg>
          </div>
          <p>Не дайте колонкам <strong>переполниться</strong> — максимум 8 кубиков!</p>
        </div>
        <div class="tutorial-step">
          <div class="tutorial-icon" aria-hidden="true">
            <svg viewBox="0 0 24 24" focusable="false">
              <path d="M12 10.941c2.333 -3.308 .167 -7.823 -1 -8.941c0 3.395 -2.235 5.299 -3.667 6.706c-1.43 1.408 -2.333 3.294 -2.333 5.588c0 3.704 3.134 6.706 7 6.706c3.866 0 7 -3.002 7 -6.706c0 -1.712 -1.232 -4.403 -2.333 -5.588c-2.084 3.353 -3.257 3.353 -4.667 2.235" />
            </svg>
          </div>
          <p>Собирайте <strong>комбо</strong> подряд для увеличения множителя очков!</p>
        </div>
      </div>
      <button id="btn-tutorial-back" class="btn btn-primary">Понятно!</button>
    </div>
  </div>

  <!-- Экран настроек -->
  <div id="settings-screen" class="screen">
    <div class="settings-container">
      <h2>Настройки</h2>
      <div class="settings-list">
        <div class="setting-item">
          <span>Звук</span>
          <label class="toggle">
            <input type="checkbox" id="setting-sound" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="setting-item">
          <span>Вибрация</span>
          <label class="toggle">
            <input type="checkbox" id="setting-vibration" checked>
            <span class="toggle-slider"></span>
          </label>
        </div>
        <div class="setting-item">
          <span>Сложность</span>
          <select id="setting-difficulty" class="select-input">
            <option value="easy">Легко</option>
            <option value="medium" selected>Нормально</option>
            <option value="hard">Сложно</option>
          </select>
        </div>
        <div id="fullscreen-setting" class="setting-item" style="display:none">
          <span>Полный экран</span>
          <button id="btn-fullscreen" class="btn btn-small btn-secondary">Включить</button>
        </div>
      </div>
      <button id="btn-settings-back" class="btn btn-primary">Назад</button>
    </div>
  </div>

  <!-- Экран игры -->
  <div id="game-screen" class="screen">
    <!-- Верхняя панель -->
    <div id="game-header">
      <button id="btn-fullscreen-game" class="btn-icon header-btn-left" title="Полный экран" aria-label="Полный экран" style="display:none">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M16 4l4 0l0 4" />
          <path d="M14 10l6 -6" />
          <path d="M8 20l-4 0l0 -4" />
          <path d="M4 20l6 -6" />
          <path d="M16 20l4 0l0 -4" />
          <path d="M14 14l6 6" />
          <path d="M8 4l-4 0l0 4" />
          <path d="M4 4l6 6" />
        </svg>
      </button>
      <button id="btn-sound-game" class="btn-icon header-btn-sound" title="Выключить звук" aria-label="Выключить звук">
        <svg class="icon-sound-on" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M15 8a5 5 0 0 1 0 8" />
          <path d="M17.7 5a9 9 0 0 1 0 14" />
          <path d="M6 15h-2a1 1 0 0 1 -1 -1v-4a1 1 0 0 1 1 -1h2l3.5 -4.5a.8 .8 0 0 1 1.5 .5v14a.8 .8 0 0 1 -1.5 .5l-3.5 -4.5" />
        </svg>
        <svg class="icon-sound-off" viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M15 8a5 5 0 0 1 1.912 4.934m-1.377 2.602a5 5 0 0 1 -.535 .464" />
          <path d="M17.7 5a9 9 0 0 1 2.362 11.086m-1.676 2.299a9 9 0 0 1 -.686 .615" />
          <path d="M9.069 5.054l.431 -.554a.8 .8 0 0 1 1.5 .5v2m0 4v8a.8 .8 0 0 1 -1.5 .5l-3.5 -4.5h-2a1 1 0 0 1 -1 -1v-4a1 1 0 0 1 1 -1h2l1.294 -1.664" />
          <path d="M3 3l18 18" />
        </svg>
      </button>
      <button id="btn-help-game" class="btn-icon header-btn-help" title="Подсказка" aria-label="Подсказка">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" />
          <path d="M12 16v.01" />
          <path d="M12 13a2 2 0 0 0 .914 -3.782a1.98 1.98 0 0 0 -2.414 .483" />
        </svg>
      </button>
      <button id="btn-pause" class="btn-icon header-btn-center" title="Пауза" aria-label="Пауза">
        <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
          <path d="M6 6a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1l0 -12" />
          <path d="M14 6a1 1 0 0 1 1 -1h2a1 1 0 0 1 1 1v12a1 1 0 0 1 -1 1h-2a1 1 0 0 1 -1 -1l0 -12" />
        </svg>
      </button>
      <div id="target-carousel">
          <span id="next-target-2" class="carousel-item carousel-next2">25</span>
          <span id="next-target-1" class="carousel-item carousel-next1">20</span>
          <span id="current-target" class="carousel-item carousel-current">15</span>
          <span id="current-target-label">СОБЕРИ СУММУ ИЗ БЛОКОВ, ЦЕЛЬ:</span>
      </div>
    </div>

    <!-- Очереди кубиков -->
    <div id="queues-display">
      <div class="queue-item" data-col="0"></div>
      <div class="queue-item" data-col="1"></div>
      <div class="queue-item" data-col="2"></div>
      <div class="queue-item" data-col="3"></div>
    </div>

    <!-- Игровое поле -->
    <div id="game-field">
      <canvas id="game-canvas"></canvas>
      <!-- Индикаторы опасности колонок -->
      <div id="column-dangers">
        <div class="col-danger" data-col="0"></div>
        <div class="col-danger" data-col="1"></div>
        <div class="col-danger" data-col="2"></div>
        <div class="col-danger" data-col="3"></div>
      </div>
    </div>

    <!-- Нижняя панель -->
    <div id="game-footer">
      <div id="score-display">
        <span class="footer-label">Счёт</span>
        <span id="score-value">0</span>
      </div>
      <div id="combo-display" class="invisible">
        <div class="combo-timer-container">
          <svg class="combo-timer-svg" viewBox="0 0 36 36">
            <circle class="combo-timer-bg" cx="18" cy="18" r="16"></circle>
            <circle class="combo-timer-progress" cx="18" cy="18" r="16"></circle>
          </svg>
          <span id="combo-value">×1.5</span>
        </div>
        <span class="footer-label">КОМБО</span>
      </div>
      <div id="level-display">
        <span class="footer-label">Уровень</span>
        <span id="level-value">1</span>
      </div>
    </div>
  </div>

  <!-- Экран паузы -->
  <div id="pause-overlay" class="overlay hidden">
    <div class="overlay-content">
      <h2>Пауза</h2>
      <button id="btn-resume" class="btn btn-primary">Продолжить</button>
      <button id="btn-restart" class="btn btn-secondary">Новая игра</button>
      <button id="btn-quit" class="btn btn-secondary">В меню</button>
    </div>
  </div>

  <!-- Экран конца игры -->
  <div id="gameover-overlay" class="overlay hidden">
    <div class="overlay-content gameover-content">
      <h2>Игра окончена</h2>
      <div class="gameover-stats">
        <div class="go-stat">
          <span class="go-stat-label">Счёт</span>
          <span id="go-score" class="go-stat-value">0</span>
        </div>
        <div class="go-stat">
          <span class="go-stat-label">Уровень</span>
          <span id="go-level" class="go-stat-value">1</span>
        </div>
        <div class="go-stat">
          <span class="go-stat-label">Рекорд</span>
          <span id="go-highscore" class="go-stat-value">0</span>
        </div>
        <div id="go-new-record" class="hidden">
          <svg viewBox="0 0 24 24" aria-hidden="true" focusable="false">
            <path d="M8 21l8 0" />
            <path d="M12 17l0 4" />
            <path d="M7 4l10 0" />
            <path d="M17 4v8a5 5 0 0 1 -10 0v-8" />
            <path d="M3 9a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
            <path d="M17 9a2 2 0 1 0 4 0a2 2 0 1 0 -4 0" />
          </svg>
          <span>Новый рекорд!</span>
        </div>
      </div>
      <button id="btn-play-again" class="btn btn-primary">Играть снова</button>
      <button id="btn-go-menu" class="btn btn-secondary">В меню</button>
    </div>
  </div>

  <!-- FPS-счётчик (debug) -->
  <div id="fps-counter" class="hidden">FPS: 60</div>

  <script src="js/utils.js"></script>
  <script src="js/storage.js"></script>
  <script src="js/generator.js"></script>
  <script src="js/ui.js"></script>
  <script src="js/game.js"></script>
  <script>
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('sw.js').catch(() => {});
    }
  </script>
</body>
</html>
